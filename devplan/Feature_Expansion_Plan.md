# I2g 기능 확장 구현 계획서

> 목적: 기존 Background Cleaner를 “핵심 기능 중 하나”로 확장하고, 픽셀 아트 워크플로에 필요한 고빈도 기능(픽셀 퍼펙트, 업스케일/리사이즈, 팔레트/색상 편집, 애니메이션 정렬)을 단일 GUI에서 제공한다.
> 전제: 현행 코드베이스(Python + Tkinter + Pillow)를 기반으로 단계적으로 확장한다.

---

## 1) 목표 및 범위

### 핵심 목표
- **픽셀 퍼펙트(외곽선 정리 포함) 지원**: 윤곽선 보존/정제 + 픽셀 단위 보간/정합.
- **업스케일/리사이즈 기능 제공**: Nearest Neighbor 중심 + 선택적 보간 옵션.
- **팔레트 기반 편집**: 픽셀 색상 바꾸기, 인접 픽셀 합치기, 픽셀 나누기(분해/분할) 기능.
- **애니메이션화 및 정렬 보조**: 기준점(앵커) 설정, 프레임 정렬/오버레이.
- **좌측 패널 + 작업 영역**: 기능별 패널 제공, 중앙 캔버스는 작업 영역으로 통일.

### 비범위(초기)
- 실시간 3D 변형/고급 쉐이더
- 복잡한 레이어 편집(포토샵급)
- 서버/클라우드 처리

---

## 2) UI/UX 구조 설계(현대적 그라데이션 + 다크 톤)

### 레이아웃
- **좌측 패널(툴/기능)**
  - 기능 탭(Background Clean, Pixel Perfect, Resize/Scale, Palette, Animation)
  - 기능별 파라미터/옵션/버튼
- **중앙 캔버스(작업 화면)**
  - 원본/결과 분리 또는 탭 전환
  - 확대/축소, 드래그, 픽셀 그리드 토글
- **하단 바**
  - 상태, 진행률, 메모리/시간, 프레임/좌표 정보

### 스타일 가이드(세련된 그라데이션)
- **배경 그라데이션**: 다크 그레이 2~3단(예: #1f1f1f → #2a2a2a → #111)
- **포인트 컬러**: 약간 푸른 톤(#3a3f5e) 또는 청록(#2b5666)
- **텍스트**: #E5E5E5, 강조 #F2F2F2
- **버튼/토글**: 평면 + 얇은 라운드 + 미세 그림자

---

## 3) 기능 모듈 설계

### 3.1 Background Clean (기존)
- 기존 `cleanup_background`를 유지.
- **픽셀 퍼펙트 옵션** 추가(윤곽선 보존 + pixel smoothing 최소화).

### 3.2 Pixel Perfect (신규)
- **외곽선 픽셀 퍼펙트**
  - 알고리즘: 윤곽선 감지 → 불필요한 대각선/노이즈 정리.
  - UI 옵션: 강도(낮음/중간/높음), 윤곽선 두께 유지 여부.

### 3.3 Resize / Upscale
- **Nearest Neighbor** 기본 + 선택적으로 Bilinear/Bicubic.
- 스케일 프리셋(2x, 4x, 8x), 수동 입력.
- 픽셀 아트 특화: **"크리스프 모드"** (Nearest 전용).

### 3.4 Palette Tools (핵심)
- **팔레트 추출**: 이미지에서 사용된 색상 리스트 생성.
- **색상 바꾸기(Replace)**: 특정 색상을 다른 색상으로 치환.
- **인접 픽셀 합치기(Merge)**:
  - **정사각형 단위 제한(제곱수 기반)**: 1px, 4px(2x2), 9px(3x3), 16px(4x4) 등 **정사각형 블록**만 병합.
  - 기준 색상 군집화 후 **동일/유사 색상 블록을 1px(대표 색)**으로 합쳐 **픽셀 수 최적화**.
- **픽셀 나누기(Split)**:
  - **정사각형 단위 제한(제곱수 기반)**: 1px → 2x2/3x3/4x4 등 정사각형으로 분할.
  - 색상 분해 시에도 **정사각형 타일**을 기준으로 유지.

### 3.5 Animation Tools
- **프레임 생성**: 단일 이미지 → 반복/슬라이스 기반 프레임.
- **기준점 정렬**: 앵커 설정 + 프레임 오버레이 비교.
- **프레임 이동 도우미**: 드래그/키보드로 정렬.

---

## 4) 기술 설계(현 구조 기반)

### 4.1 구조 재정비
- `gui/`를 패키지로 유지
- 모듈 분리:
  - `gui/tools/background.py`
  - `gui/tools/pixel_perfect.py`
  - `gui/tools/resize.py`
  - `gui/tools/palette.py`
  - `gui/tools/animation.py`

### 4.2 데이터 모델
- `ImageState`: 원본/작업 이미지, 팔레트, 선택 영역
- `ToolState`: 현재 도구/옵션/프리셋
- `AnimationState`: 프레임 리스트, 앵커 좌표

### 4.3 렌더링
- Pillow 기반 유지
- Tkinter Canvas 렌더링 최적화:
  - 캐시된 resized 이미지 재사용
  - 작업 이미지 변경 시만 재렌더

---

## 5) 구현 로드맵(단계별)

### Phase 1 (기반 정비)
- 좌측 패널 + 탭 UI 구조
- 기본 스타일 적용(다크 그라데이션)
- Background Clean 분리 모듈화

### Phase 2 (픽셀/팔레트 기능)
- 팔레트 추출/치환
- 픽셀 퍼펙트 외곽선 정리

### Phase 3 (Resize/Upscale)
- 리사이즈 옵션 추가
- Nearest 강조 + 프리셋

### Phase 4 (애니메이션)
- 프레임 생성/편집
- 기준점 정렬 UI

---

## 6) 주요 리스크 및 대응

| 리스크 | 설명 | 대응 |
|---|---|---|
| 성능 | 팔레트/픽셀 연산 시 느려질 수 있음 | 픽셀 연산 최적화, 캐시 적용 |
| UI 복잡도 | 기능이 많아 UI가 복잡해질 가능성 | 탭 + 섹션 폴딩 구조 |
| 메모리 | 여러 프레임/이미지 저장 시 메모리 증가 | 제한된 히스토리, lazy loading |

---

## 7) 다음 액션 (실행 가능 작업)

1. **UI 리뉴얼**: 좌측 패널 + 그라데이션 스타일 레이아웃 구성
2. **Palette Tool MVP**: 팔레트 추출 + 색상 치환 + 간단 UI
3. **Pixel Perfect MVP**: 윤곽선 픽셀 정리 1차 구현
4. **Resize MVP**: Nearest 기반 업스케일 기능

---

## 8) 기대 결과
- 픽셀 아트 제작 워크플로에 맞춘 **복합 툴**
- 기존 Background Cleaner는 **여러 기능 중 하나로 흡수**
- 고빈도 작업(팔레트/리사이즈/정렬)을 하나의 도구에서 처리
